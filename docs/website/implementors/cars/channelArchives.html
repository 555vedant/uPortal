<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Channel ARchives</title>
  <meta http-equiv="content-type">
  <link href="../../uportal.css" rel="stylesheet">
</head>
<body style="background-color: rgb(255, 255, 255);">
<table cellspacing="0" cellpadding="0" width="100%">
  <tbody>
    <tr>
      <td align="left" valign="bottom" colspan="3"><img
 src="../../images/uportal-head.gif" alt="uPortal by JA-SIG" border="0"
 height="87" width="592"> </td>
    </tr>
    <tr>
      <td><img src="../../images/spacer.gif" alt="." border="0"
 height="4" width="1"> </td>
    </tr>
  </tbody>
</table>
<table cellspacing="0" cellpadding="5" width="100%" border="0">
  <tbody>
    <tr>
      <td valign="top" width="150" bgcolor="#ccccff"> <img
 src="../../images/spacer.gif" border="0" height="4"> <br>
      <p><a class="sidelinks" href="http://www.ja-sig.org/"><b> JA-SIG
Home</b></a></p>
      <p><a class="sidelinks" href="../../index.html"><b> About uPortal</b></a></p>
      <p><a class="sidelinks" href="../../docs.html"><b> Documentation</b></a></p>
      <p><a class="sidelinks" href="../../administrators/index.html"><b>
Getting Started</b></a></p>
      <p><a class="sidelinks" href="../../developers/index.html"><b>
Developers</b></a></p>
	
      <p><a class="sidelinks" href="../index.html"><b> Implementors</b></a></p>
	
      <p><a class="sidelinks" href="../../users/index.html"><b> Users</b></a></p>
      <p><a class="sidelinks" href="../../architecture/index.html"><b>
Background</b></a></p>
      <p><a class="sidelinks" href="../../release/index.html"><b> Release</b></a></p>
      <p><img src="../../images/mellon.gif" alt="" border="0"
 width="145" height="93"> </p>
      </td>
<!-- main body goes in this table cell  (see BELOW)   --> <td
 valign="top"> <img height="4" width="692"
 src="../../images/orange-pixel.gif" border="0" alt="."> <a
 href="channelArchives_prt.html"> <img
 src="../../images/print_this.gif" border="0" width="86" height="20"
 alt="Printable version of this document" align="right"> </a> <br>
<!-- TO CHANGE: main body goes HERE <<<<<<<<<<<<<<<<<< --><!-- start cut this section to put into jasig table cell format -->
      <div align="center"><big><big>uPortal Channel ARchives</big></big><br>
      </div>
      <br>
      <big><br>
      <span style="font-weight: bold;"> Contents</span><br>
      </big>
      <blockquote><a href="#what_is_a_CAR">What They Are</a><br>
        <a href="#installation">Installation</a><br>
        <a href="#do_they_require_different_code">Do They Require Different Code?</a><br>
        <a href="#building_them">Building Them</a><br>
        <a href="#deployment_descriptors">Deployment Descriptors and Their Supported Tags</a><br>
        <table cellpadding='0' cellspacing='0' style="margin-left: 20px;">
        <tr><td><a href="#workers">&lt;worker&gt;</a></td><td>&nbsp;Plugging in and Using Workers</td></tr>
        <tr><td><a href="#services">&lt;service&gt;</a></td><td>&nbsp;Installing a Service</td></tr>
        <tr><td><a href="#extensions">&lt;ext&gt;</a></td><td>&nbsp;Using Extension Blocks</td></tr>
        <tr><td><a href="#channelPublishing">&lt;channel-definition&gt;</a></td><td>&nbsp;Publishing Channels</td></tr>
        <tr><td><a href="#channeltypes">&lt;channel-type&gt;</a></td><td>&nbsp;Adding Channel Types</td></tr>
        <tr><td><a href="#databaseTables">&lt;database&gt;</a></td><td>&nbsp;Installing Database Tables</td></tr>
        <tr><td><a href="#conditionalProcessing">&lt;processIf&gt;</a></td><td>&nbsp;Conditional Processing of Tags</td></tr>
        </table>
      </blockquote>
      <br>
      <br>
      <big><a name="what_is_a_CAR"></a><span style="font-weight: bold;">What is a Channel ARchive?</span></big><br>
      <p> A Channel ARchive, or <span style="font-style: italic;">CAR</span>, in its simplest form is just a java archive with a  ".car" extension. They are created with the <span style="font-style: italic;">Jar</span> utility provided with the Java SDK. CARs can contain all elements used for the construction and presentation of custom java channel types and their contents. A fully functional CAR is included <a href="carlot.car">here</a> to illustrate their capability. (Note: Some browsers append ".zip" to this file upon downloading. Simply rename it to carlot.car.) This car contains a channel known as the CAR LOT. It shows what cars exist in the portal and shows their contents. It contains the source java file, the compiled class file, a stylesheet list file, an XSLT stylesheet, and two images that are served up to the browser from within the CAR.  &nbsp;</p>
      <p> You must have uPortal 2.1 or later to use CARs. You can publish CAR LOT using the following values.<br>
      </p>
      <p><br>
      </p>
      <table cellpadding="2" cellspacing="2" border="1"
 style="text-align: left; width: 642px; margin-left: 40px;">
        <tbody>
          <tr>
            <td style="vertical-align: top; text-align: center;"><small><span
 style="font-weight: bold;">Property</span><br>
            </small></td>
            <td style="vertical-align: top; text-align: center;"><small><span
 style="font-weight: bold;">Value</span><br>
            </small></td>
          </tr>
          <tr>
            <td style="vertical-align: top;"><small>Channel Type<br>
            </small></td>
            <td style="vertical-align: top;"><small>Custom Java<br>
            </small></td>
          </tr>
          <tr>
            <td style="vertical-align: top;"><small>Channel Title,<br>
	     Channel Name,<br>
	     Channel Funtional Name,<br>
	     Channel Description<br>
            </small></td>
            <td style="vertical-align: top;"><small>CARLOT<br>
            </small></td>
          </tr>
          <tr>
            <td style="vertical-align: top;"><small>Channel Timeout<br>
            </small></td>
            <td style="vertical-align: top;"><small>4000<br>
            </small></td>
          </tr>
          <tr>
            <td style="vertical-align: top;"><small>Channel Class<br>
            </small></td>
            <td style="vertical-align: top;"><small>com.sct.pipeline.uportal.channels.carlot.Channel<br>
            </small></td>
          </tr>
          <tr>
            <td style="vertical-align: top;"><small>Channel Controls<br>
            </small></td>
            <td style="vertical-align: top;"><small>Has none.<br>
            </small></td>
          </tr>
          <tr>
            <td style="vertical-align: top;"><small>Selected Categories<br>
            </small></td>
            <td style="vertical-align: top;"><small>Choose as desired.<br>
            </small></td>
          </tr>
          <tr>
            <td style="vertical-align: top;"><small>Selected Groups and/or People<br>
            </small></td>
            <td style="vertical-align: top;"><small>Choose as desired.<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
      <p> In uPortal 2.2, CARs received the added capabilities of housing services and workers and being able to declare them using a deployment descriptor file. (See "<a href="#deployment_descriptors">What is a Deployment Descriptor?</a>" later in this document.) A channel archive named deployTest.car containing a service, a worker, and an extension block can be obtained <a href="deployTest.car">here</a>. The deployTest.car archive does not contain a channel. Its sole purpose is to illustrate the power and use of the deployment descriptor support. You must have uPortal 2.2 or later for this archive to work. Upon installation and restarting the portal click on the following link to access the worker which will be automatically installed.<br><br> <a href="http://localhost:8080/uPortal/worker.com_sct_pipeline_uportal_channels_deployTest_HelloWorker.uP">http://localhost:8080/uPortal/worker.com_sct_pipeline_uportal_channels_deployTest_HelloWorker.uP</a><br><br>This link assumes the portal is running on the local machine on port 8080. If it isn't, then replace the appropriate host and port in the URL. You'll notice that the returned page shows if the worker and service were installed and if the extension block of the deployment descriptor executed successfully.</p>
      <p>Through these examples we see that CARs are containers that can house multiple channels, their resources, workers and services, and a deployment descriptor indicating what resources they contain so that in the case of workers and services the portal can instantiate and use them. CARs can be used to package up and deploy from a single channel, worker, or service to an entire channel application suite.</p>
      <big><a name="installation"></a><span
 style="font-weight: bold;">How Are They Installed?</span></big><br>
      <p> By default the portal looks in <webApplicationRoot>/WEB-INF/cars or any of its subdirectories for channel archives. To install a CAR simply place it in that directory or its subdirectories and restart the portal. Upon start up, the portal scans the cars directory structure for all CARs and loads internal tables with paths to each of the resources available from the archives. It also processes all extension blocks declared in any deployment descriptors found in the archives. (See "<a href="#deployment_descriptors">What is a Deployment Descriptor?</a>" later in this document.)</p>
      <p>If the portal is deployed in a container that uses a WAR file for deployment that container may not allow access to the default car directory in the WEB-INF directory. If such is the case or if you simply want to place your CARs in some other location you can define the following property in the portal.properties file with a fully qualified path to the location of the directory that will house your channel archives.<br><br>
      <blockquote><code>org.jasig.portal.car.CarResources.directory</code></blockquote>
      <p>The name of a channel archive has no affect on its contents or the use of those contents by the portal. If two CARs aquired from different sources but containing different components need to be deployed in the same directory, then simply rename one or the other prior to installing in the directory. Alternatively, you could create subdirectories beneath the car directory based on the java package directories of the provider of the CAR. Then the CARs can be placed into the appropriate subdirectories with their names unchanged.</p>
      <big><a name="do_they_require_different_code"></a><span
 style="font-weight: bold;">Do They Require Different Code?</span></big><br>
      <p>Channels may require minor changes to be deployed in a CAR. For example, an image used in the channel and located in some subdirectory of the <webApplicationRoot>/media directory would most likely have an XSLT stylesheet with code like the following:</p>
      <blockquote><code>&lt;xsl:variable name="mediaPath"&gt;media/org/jasig/portal/channels/Cbookmarks&lt;/xsl:variable&gt;</code><br>
        <code>&nbsp; ...</code><br>
        <code>&lt;img src="{$mediaPath}/folder_delete.gif"/&gt;</code><br>
        <code>&nbsp; ...</code><br>
      </blockquote>
      <p>This would still be appropriate if the folder_delete.gif image were still located in the appropriate place beneath the media directory. But such an approach would negate one of the major goals of a CAR; namely to place all resources needed by a channel into the archive to prevent tight coupling between the stylesheet and a file located in some other directory. Such a deployment is susceptible to installation errors if the image is not located in the correct location or is subsequently deleted.</p>
      <p>A better solution is to place the image in the CAR and modify the channel to obtain an appropriate URL for aquiring the image from the CAR. To do so typically requires calling one of three versions of a method in <code>ChannelRuntimeData</code> specifically designed to construct the base of this URL and then passing that value to the XSLT stylesheet for use in constructing the full URLs to the various images used by the channel.</p>
      <p><code>ChannelRuntimeData</code> has three methods to assist with constructing URLs appropriate for browsers to aquire resources out of channel archives. These are:</p>
      <blockquote><code>getBaseMediaURL( Object aChannelObject )</code><br>
        <code>getBaseMediaURL( Class aChannelClass )</code><br>
        <code>getBaseMediaURL( String resourcePath )</code><br>
      </blockquote>
      <p>The first two can be passed some object or class that is known to only be deployed with the channel. Typically, this is the channel itself. These two methods then look to see whether or not the class of the object was loaded from a CAR. If it was then the method returns a URL base that can be used to aquire images from a CAR. If the class was not loaded from a CAR, then the method returns the traditional URL base path for images namely, "<i>/media</i>.". The format for the URL base for CAR-accessible images is similar in form to:</p>
      <blockquote><code>tag.idempotent.worker.carRsrc.uP?carRsrc=</code><br>
      </blockquote>
      <p>As you can see the URL still needs a value appended indicating what car resource is desired. That value must be the path as found within the channel archive. For example, if you execute <code>jar tf carlot.car</code> you'll see that the car.jpg image has a path of <code>com/sct/pipeline/uportal/channels/carlot/car.jpg</code>. This would be the value to append to the base URL to allow the browser to aquire that image directly from carlot.car.</p>
      <p>Note, the package relative directories are used not only for CAR LOT'S compiled class files but also for all of its resources. Like Java code in general all resources deployed in CARs should be placed in globally unique, package relative directories as specified in Java Language Specification, section 7.7. This is because all resources aquired from CARs share the same namespace. If CAR LOT didn't use package relative directories, then the path to its <code>car.jpg</code> image would consist only of the file name itself. The probability of contention between such a path in one CAR and an identical path to a similarly named but completely different image in another CAR would cause one of the two images to be served up in place of both and the other would never be accessible.<p>
      <p>For stylesheet lists the XSLT stylesheets can be specified with either the full path to the stylesheet or a path relative to the location of the stylesheet list. For example, each of the following enties are valid and point to the same resource within the CAR, assuming that the stylesheet list file channel.ssl containing such entries had a path within the CAR of <code>com/sct/pipeline/uportal/channels/carlot/channel.ssl</code>. The first two are relative. The third has the full path specified.</p>
      <blockquote><code>&lt;?xml-stylesheet title="CarListStyleSheet" href="stylesheets/channel.xsl"&gt;</code><br><br>
      <code>&lt;?xml-stylesheet title="CarListStyleSheet" href="../carlot/stylesheets/channel.xsl"&gt;</code><br><br>
      <code>&lt;?xml-stylesheet title="CarListStyleSheet" href="com/sct/pipeline/uportal/channels/carlot/stylesheets/channel.xsl"&gt;</code><br>
      </blockquote>
      <p> Note that the parent directory traversal regular expression "../" was added in uPortal version 2.2. Similar full or relative paths can be used for an XSLT's <code>xsl:include</code> and <code>xsl:import</code> elements and for its <code>document()</code> method as shown below. Again, the first two are relative and the third is fully qualified.</p>
      <blockquote><code>&lt;?xsl:variable name="palette" select="document('v2colors.xml')/*/color"/&gt;</code><br><br>
      <code>&lt;?xsl:import href="../tree/view.xsl"/&gt;</code><br><br>
      <code>&lt;?xsl:include href="com/sct/uportal/channels/accnt/edits.xsl"/&gt;</code><br>
      </blockquote>
      <p>If a channel needs to access other resources located in a CAR, these resources are available just as any other resource obtained from a class loader. However, the class loader provided by the channel archive infrastructure must be used. You can obtain a handle on this class loader by using the <code>org.jasig.portal.car.CarResources</code> class. Then you can ask for a resource using the fully qualified path within the CAR. In the following code snippet I am aquiring the bytes for the image housed in deployTest.car.</p>
      <blockquote><code>CarResources cRes = CarResources.getInstance();</code><br>
      <code>ClassLoader cl = cRes.getClassLoader();</code><br>
      <code>String img = "com.sct.pipeline.uportal.channels.deployTest.youveGotIt.jpg";</code><br>
      <code>InputStream iStream = cl.getResourceAsStream( img );</code><br>
      <code>// now read the stream of bytes.</code><br>
      </blockquote>
      <p>Alternatively, if you have a class that was loaded from a CAR, you can use its <code>getResource()</code> and <code>getResourceAsStream()</code> methods because all classes delegate to the class loader by which they were loaded. Additionally, since the CAR class loader delegates first to the parent class loader before looking in CARs you can use this class loader for any resource expected on the classpath.</p>
      <p>Finally, the <code>org.jasig.portal.util.ResourceLoader</code> class uses the CAR class loader. Therefore, this class can obtain resources from both the regular classpath and within CARs.</p>
      <big><a name="building_them"></a><span
 style="font-weight: bold;">How Do You Build Them?</span></big><br>
      <p>To build a CAR first create the directory structure that is desired within the CAR. For example, lets extract, delete, and then rebuild  deployTest.car. Assume that we have created a <code>temp</code> directory and placed in it deployTest.car. Now in a command shell change directory into <code>temp</code> and extract the CAR's contents.</p>
      <blockquote><code>jar -xf deployTest.car</code><br></blockquote>
      <p>There will now be two subdirectories in <code>temp</code>: <code>META-INF</code> and <code>com</code>. <code>META-INF</code> contains the <code>comp.xml</code> deployment descriptor and the standard manifest file generated by the <code>jar</code> utility. The <code>com</code> directory is the top of the package relative directories housing the java source files, compiled class files, and an image file. After deleting deployTest.car we recreate it by executing:</p>
      <blockquote><code>jar -cf deployTest.car com META-INF</code><br></blockquote>
      <p>We now see deployTest.car again. Don't forget to specify both <code>META-INF</code> and <code>com</code> in the above command or the CAR will be lacking some of its resources.</p>
      <p> Although this is generally how a channel archive is created the process is usually more involved. For example, in a development environment using CVS to version and backup your code, there would be a <code>CVS</code> directory in each of the subdirectories. These should not be placed into the archive. A better approach would be to use a tool like <a href="http://ant.apache.org"><code>ant</code></a> to automate copying the files needed into a temporary directory. Files will most likely come from multiple locations: java sources from a source area, class files from a build area, images from somewhere else, etc. <code>ant</code> can bring them all together, execute the jar utilty, and then place the CAR wherever it is supposed to go. It takes a little time to get familiar with <code>ant</code> but the time savings are worth it.</p>
      <big><a name="deployment_descriptors"></a><span
 style="font-weight: bold;">What is a Deployment Descriptor?</span></big><br>
      <p>A deployment descriptor provides a mechanism whereby elements contained within the CAR can be conveyed to the portal and the portal can take action to access and use those elements. The deployment descriptor for a CAR has the name <code>comp.xml</code>. This name is case sensitive and must be located in the <code>META-INF</code> directory within a CAR. Performing <code>jar tf deployTest.car</code> on the deployTest CAR reveals the full path to its deployment descriptor conforming to this requirement: <code>META-INF/comp.xml</code>.</p>
      <p>As of version 2.2 deployment descriptors supported the <code>ext</code>, <code>service</code>, and <code>worker</code> tags. As of 2.4 deployment descriptors have been extended with the <code>channel-definition</code>, <code>channel-type</code>, <code>database</code>, and <code>processIf</code> tags. Therefor, the deployment descriptor currently has the following general form for its document type. For the structure of the <code>channel-definition</code> tag see the <code>channelDefinition.dtd</code> file in the portal's <code>webpages/dtd</code> directory.)></p> 
      <blockquote><code>&lt;!ELEMENT component (description | ext | service | worker | processIf | channel-type | database | channel-definition)+&gt;
</code><br>
      <code>&lt;!ELEMENT description (#PCDATA)&gt;</code><br>
      <code>&lt;!ELEMENT ext (#PCDATA)&gt;</code><br>
      <code>&lt;!ATTLIST ext contentHandler CDATA #REQUIRED&gt;</code><br>
      <code>&lt;!ELEMENT service (#PCDATA)&gt;</code><br>
      <code>&lt;!ELEMENT worker EMPTY&gt;</code><br>
      <code>&lt;!ATTLIST worker class CDATA #REQUIRED&gt;</code><br><br>
      <code>&lt;!ELEMENT channel-type (name, class, description, uri)&gt;</code><br>
      <code>&lt;!ELEMENT name (#PCDATA)&gt;</code><br>
      <code>&lt;!ELEMENT class (#PCDATA)&gt;</code><br>
      <code>&lt;!ELEMENT uri (#PCDATA)&gt;</code><br><br>
      <code>&lt;!ELEMENT database (drop-tables, create-tables, populate-tables, create-script, tables, data?)&gt;</code><br>
      <code>&lt;!ELEMENT drop-tables (#PCDATA)&gt;</code><br>
      <code>&lt;!ELEMENT create-tables (#PCDATA)&gt;</code><br>
      <code>&lt;!ELEMENT populate-tables (#PCDATA)&gt;</code><br>
      <code>&lt;!ELEMENT create-script (#PCDATA)&gt;</code><br>
      <code>&lt;!ELEMENT tables (#PCDATA)&gt;</code><br>
      <code>&lt;!ELEMENT data (#PCDATA)&gt;</code><br><br>
      <code>&lt;!ELEMENT processIf (service | ext | database | channel-type | channel-definition)+&gt;</code><br>
      <code>&lt;!ATTLIST processIf</code><br>
      <code style="margin-left: 30px;">fname CDATA #REQUIRED</code><br>
      <code style="margin-left: 30px;">version (equalTo | greaterThan | greaterThanOrEqual | lessThan | lessThanOrEqual | notEqualTo) #REQUIRED</code><br>
      <code style="margin-left: 30px;">major CDATA #REQUIRED</code><br>
      <code style="margin-left: 30px;">minor CDATA #REQUIRED</code><br>
      <code style="margin-left: 30px;">micro CDATA #REQUIRED</code><br>
      <code style="margin-left: 30px;">setMajor CDATA #REQUIRED</code><br>
      <code style="margin-left: 30px;">setMinor CDATA #REQUIRED</code><br>
      <code style="margin-left: 30px;">setMicro CDATA #REQUIRED</code><br>
      <code style="margin-left: 30px;">setDescription CDATA #REQUIRED&gt;</code><br>
      </blockquote>
      <p>An example of a deployment descriptor is that used in deployTest.car.</p>
      <blockquote><code>&lt;component&gt;</code><br><br>
      <code>&nbsp;&lt;description&gt;Simple CAR containing a worker, service, and image extractor and a deployment descriptor, this file, that deploys these elements in the portal to illustrate the use of the deployment descriptor features.&lt;/description&gt;</code><br><br>
      <code>&nbsp;&lt;worker class="com.sct.pipeline.uportal.channels.deployTest.HelloWorker"/&gt;</code><br><br>
      <code>&nbsp;&lt;service&gt;</code><br>
      <code>&nbsp;&nbsp;&lt;name&gt;Hello Worker Hits-Count Service&lt;/name&gt;</code><br>
      <code>&nbsp;&nbsp;&lt;class&gt;com.sct.pipeline.uportal.channels.deployTest.HitsService&lt;/class&gt;</code><br>
      <code>&nbsp;&nbsp;&lt;jndi_name&gt;hitsService&lt;/jndi_name&gt;</code><br>
      <code>&nbsp;&lt;/service&gt;</code><br><br>
      <code>&nbsp;&lt;ext contentHandler="com.sct.pipeline.uportal.channels.deployTest.Extractor"&gt;</code><br>
      <code>&nbsp;&nbsp;&lt;file pathInCar="com/sct/pipeline/uportal/channels/deployTest/youveGotIt.jpg"/&gt;</code><br>
      <code>&nbsp;&lt;/ext&gt;</code><br><br>
      <code>&lt;/component&gt;</code><br>
      </blockquote>
      <big><a name="workers"></a><span style="font-weight: bold;">Plugging In and Using a Worker</span></big><br>
      <p>The <code>worker</code> element adds worker definitions into the portal beyond those found in properites/worker.properties. This element has no content and one required attribute: class. This attribute must contain the fully qualified name of a java class that implements the <code>org.jasig.portal.IWorkerRequestProcessor</code> interface. To prevent naming collisions, the name of the worker is the same as the class name with all periods, (.), replaced with underscores, (_). This greatly reduces the posibility of naming collisions between workers declared in different CARs.</p>
      <p> To access such a worker, a channel must generate an appropriate URL by using the <code>getBaseWorkerURL()</code> methods in <code>ChannelRuntimeData</code> and passing in the worker's name. For deployTest.car's worker, we would aquire a URL to access that worker with the following code within our channel, assuming the <code>rd</code> variable contains the <code>ChannelRuntimeData</code> object and that the full path has been truncated for brevity.<p>    
      <blockquote><code>rd.getBaseWorkerURL( "com_sct_..._HelloWorker" );</code><br>
      </blockquote>
      <p>The returned value could then be passed into the channel's XSLT stylesheets to provide links to access the worker as needed. Since workers can specify the content type being sent back they represent one way of serving up content of any type from the portal.</p>
      <big><a name="services"></a><span style="font-weight: bold;">Installing a Service</span></big><br>
      <p>The <code>service</code> element adds services into the portal beyond those of the service definitions found in properties/services.xml. There is no interface defined for services; they are simply utilities that should be started when the portal is started. Optionally they may be accessed by the portal's JNDI context. The contents of the <code>service</code> element must conform to the allowed structures of the services elements in the properties/services.xml file. The structure of this file is defined by the <code>services.dtd</code> located in the portal's <code>webpages/dtd</code> directory.</p>
      <p>For example, the deployTest.car deployment descriptor's <code>service</code> element causes a simple counter class to be instantiated and accessible via the portal's JNDI context. Since a new instance of the worker class is instantiated for each request destined for a worker this long lived counter class is used to keep track of the number of times this worker was accessed.</p>
      <big><a name="extensions"></a><span style="font-weight: bold;">Using Extension Blocks</span></big><br>
      <p>The <code>ext</code> element is an extension mechanism used to perform some functionality not available through the supported deployment descriptor tags. This block can be used to prototype functionality that can later be promoted to new descriptor tags. This block may include configuration information that should be passed to the code accessed by the processing of this block. This element has a single required attribute: <code>contentHandler</code>. This attribute must contain the fully qualified name of a Java class that implements the <code>org.xml.sax.ContentHandler</code> interface. The contents of the <code>ext</code> element are opaque to the CAR deployment descriptor processing code. The content handler declared is instantiated and its <code>startDocument</code> method is called. Then the SAX content handler events for the contents of the <code>ext</code> element are passed to this object. When the contents are fully parsed, the content handler's <code>endDocument</code> method is called.</p>
      <p>For example, the deployTest.car deployment descriptor's <code>ext</code> element contains a single element: <code>file</code>. It has a single attribute, <code>pathInCar</code>, containing the path to an image that should be moved to the web visible media directory. The content handler uses this to see if the image is already available in the web visible area and if not to extract it from the CAR and place it in that location.</p>
      <p>Another example of using an extension block can be seen in an archive provided for integrating an external system with SCT's Luminis product. The Luminis product provides the ability to declaratively indicate how some URLs are accessed (e.g. accessed by HTTPS, by someone with the "student" role, etc.) As part of integration, this external system provides a CAR housing a worker that can receive information from the external system and take action in Luminis based on that information. The extension block declared in the CAR's deployment descriptor is illustrated below. Note the much more complex and yet perfectly acceptable XML structure contained within the <code>ext</code> block.</p>
      <blockquote><code>&nbsp;&lt;ext contentHandler="com.sct.pipeline.SecureURLMapHandler"&gt;</code><br>
      <code>&nbsp;&nbsp;&lt;DEFINITION rootAt="cp"&gt;</code><br>
      <code>&nbsp;&nbsp;&nbsp;&lt;NODE name="worker.com_sct_pipeline_Worker.uP"&gt;</code><br>
      <code>&nbsp;&nbsp;&nbsp;&nbsp;&lt;LABEL name="secure"&gt; true &lt;/LABEL&gt;</code><br>
      <code>&nbsp;&nbsp;&nbsp;&nbsp;&lt;LABEL name="acl"&gt; role:admin &lt;/LABEL&gt;</code><br>
      <code>&nbsp;&nbsp;&nbsp;&nbsp;&lt;LABEL name="auth-method"&gt; BASIC &lt;/LABEL&gt;</code><br>
      <code>&nbsp;&nbsp;&nbsp;&lt;/NODE&gt;</code><br>
      <code>&nbsp;&nbsp;&lt;/DEFINITION&gt;</code><br>
      <code>&nbsp;&lt;/ext&gt;</code><br>
      </blockquote>
      <p> This block is used by the SecureURLMapHandler to configure the secure URL map to enforce that access to the URL "cp/worker.com_sct_pipeline_Worker.uP" is only allowed for a user with the admin role making the request via HTTPS. Additionally, since a deamon process initiates these requests, basic authentication is used so that this transaction can take place in a single HTTP request and response cycle including authentication.</p>
      <big><a name="channelPublishing"></a><span style="font-weight: bold;">Publishing Channels</span></big><br>
      <p>As of version 2.4 a channel archive can automatically publish channels that it contains. However, since the categories and groups at one institution most likely will not match those of another institution, groups and categories specified in the <code>channel-definition</code> tag are ignored. Channels that are meant to show up in the list of channels that users can subscribed to are placed in a top level <code>Auto-Published</code> category that is created automatically if it doesn't exist. For channels that are not meant to be subscribed to by users but rather appear in the portal in unique locations and ways much like the ChannelManager channel, the channel definition can include the optional empty <code>makeFNameAccessibleOnly</code> element. This causes that channel to be published in such a way that they don't show up in the list of channels available for subscription. Such a channel is accessible in focus mode only by hitting a portal URL with a query parameter of <code>uP_fname=...</code> with the value being the functional name of the channel as defined by the fname element.</p>
      <p>If a channel already exists in the portal having the same functional name as that specified for the channel being published the channel will not be published. Therefore, care must be taken to have unique functional names for channels. Additionally, the processIf tag can be used to only cause a channel to be published once and not attempted every time the portal starts up and deployment descriptors are processed.</p>
      <p>During automatic publishing of these channels access to the channels is granted only to administrators. This allows administrators to review the channels before granting access to other constituents of the portal community. Channels targeted for subscription can then be granted to other users via the Channel Manager channel. Since channels published with the makeFNameAccessibleOnly element don't appear in the Channel Manager channel access must be granted by assigning the subscribe permission for that channel to groups using the Permissions Manager channel.</p>
      <p>To see auto-publishing in action you can use either of the two links below. The first downloads the Classifieds channel created by Pete Boysen of Iowa State University packaged up as a CAR. This CAR was created using the information and suggestions presented in this document. By dropping it into <code>WEB-INF/cars</code> and bouncing the portal the channel will be published automatically. This CAR also contains a <code>database</code> element as outlined below and automatically installs the tables that classifieds needs to function. Both of these elements are wrapped in a <code>processIf</code> tag as outlined below to ensure that they are processed only once. This CAR was built using JDK 1.4.2. After restarting the portal, log in as an administrator so that you can see the Auto-Published category and subscribe to the channel. For your convenience the channel is also published with specially named but unused channel parameters whose values are descriptive text outlining what real parameters can be specified to configure the channel following Pete's excellent installation instructions.</p>
      <p>The second CAR contains a developer tool channel that exposes the stylesheets being held in the portal's XSLT classe's internal caches. Links are provided for each stylesheet and stylesheet list allowing you to selectively purge them from the cache. This channel also auto-publishes and is ready for administrators to subscribe after the web server is bounced. If dropped into a Luminis system it will also automatically register itself in the list of links that show up in when Channel Admin is selected but only for users who have been granted access to subscribe to the channel which by default is administrators. There are two versions. This CAR was built using JDK 1.3 and so should work on that JDK or later versions.</p>
      <p><a href="classifieds.car">classifieds.car</a><br/>
      <a href="upCache.car">upCache1.3.car</a></p>
      <big><a name="channeltypes"></a><span style="font-weight: bold;">Adding Channel Types</span></big><br>
      <p>As of version 2.4 a channel archive can automatically add additional channel types into the portal. This is done with the <code>channel-type</code> element. It takes four required parameters. The <code>class</code> element should contain the fully qualified class name of the class that implements the channel. This should match the value specified in the channel publishing document that is accessed via the <code>uri</code> element. The <code>name</code> element contains the name of the type as it should appear in the list of types. The <code>description</code> element contains the description as it should appear in the the list of types.</p>
      <p>The <code>uri</code> element contains the location of the channel publishing document for the channel type. This document conforms to the <code>channelPublishingDocument.dtd</code> file located in the <code>webpages/dtd</code> directory and provides dynamically generated publishing workflow steps requesting parameters unique to the channel type being published. The uri can be a fully qualified URL to the document in some remote location. Alternatively, it can be loaded from the classpath by specifying a fully qualified package path prefixed with a '/'. Finally, it can be loaded directly from within a CAR by specifying a prefix character on the full JAR resouce path as seen for the resource when performing 'jar tf someCar.car'. For example:</p>
      <blockquote>Load from remote location: <code>http://someHost/some/path/to/file.cpd</code><br>
      Load from non-CAR, class path location: <code>/some/path/to/file.cpd</code><br>
      Load from within a CAR: <code>some/path/to/file.cpd</code><br>
      </blockquote>
      <big><a name="databaseTables"></a><span style="font-weight: bold;">Installing Database Tables</span></big><br>
      <p>As of version 2.4 a channel archive can automatically install database tables and their default data set if needed by the channel. The <code>drop-tables</code>, <code>create-tables</code>, <code>populate-tables</code>, and <code>create-script</code> elements must have a value of <code>true</code> or <code>false</code>. The <code>tables</code> element must contain the path to a classpath or CAR accessible XML file containing the definition of all tables needed by the channel. The structure of this document is outlined in the <code>tables.dtd</code> located in the <code>webpages/dtd</code> directory and is the form used by the DbLoader utility. If included the <code>data</code> element contains a similar path but to a file containing the default set of data that should be loaded into the tables. This document should be the same format used by DbLoader. In fact the processing of the database tag delegates to DbLoader to perform its functions.</p>
      <p>The <code>drop-tables</code> element if set to true causes the tables to be dropped. The <code>create-tables</code> element if set to true causes the tables specified to then be created. The <code>populate-tables</code> element if set to true causes the specified default data to be loaded into the tables. The <code>create-script</code> element if set to true causes the SQL sent to the database to be captured and written to the log. And example of the database tag set is that contained in the classifieds.car deployment descriptor. It uses paths that cause DbLoader to access the tables.xml and data.xml files right out of the CAR without having to extract them into a directory somewhere.</p>
      <blockquote><code>&nbsp;&lt;database&gt;</code><br>
      <code>&nbsp;&nbsp;&lt;drop-tables&gt;true&lt;/drop-tables&gt;</code><br>
      <code>&nbsp;&nbsp;&lt;create-tables&gt;true&lt;/create-tables&gt;</code><br>
      <code>&nbsp;&nbsp;&lt;populate-tables&gt;true&lt;/populate-tables&gt;</code><br>
      <code>&nbsp;&nbsp;&lt;create-script&gt;true&lt;/create-script&gt;</code><br>
      <code>&nbsp;&nbsp;&lt;tables&gt;edu/iastate/ait/channels/classifieds/tables.xml&lt;/tables&gt;</code><br>
      <code>&nbsp;&nbsp;&lt;data&gt;edu/iastate/ait/channels/classifieds/data.xml&lt;/data&gt;</code><br>
      <code>&nbsp;&lt;/database&gt;</code><br>
      </blockquote>
      <big><a name="conditionalProcessing"></a><span style="font-weight: bold;">Conditional Processing of Tags</span></big><br>
      <p>As of 2.4 all other tags provided in a deployment descriptor can be wrapped in a <code>processIf</code> element. The purpose of this element is to prevent nested elements from being processed more than once for a given condition. The condition that can be specified is based on the version of installed software by functional name. The version is represented by major, minor, and micro components. If processed, the block will then set the version recorded by the indicated functional name to the version represented by the setMajor, setMinor, and setMicro attributes. As an example the classifieds.car contains the following element to load the database tables needed by the channel and then publish the channel. In doing so it also sets the version to 1.1.0 thereby prevent the processing from taking place again when the same descriptor is processed the next time that the portal is started.</p>
      <blockquote><code>&nbsp;&lt;processIf</code><br>
      <code>&nbsp;&nbsp;fname="edu.iastate.ait.channels.classifieds.CClassifieds"</code><br>
      <code>&nbsp;&nbsp;version="lessThan"</code><br>
      <code>&nbsp;&nbsp;setMajor="1" setMinor="1" setMicro="0"</code><br>
      <code>&nbsp;&nbsp;setMajor="1" setMinor="1" setMicro="0"</code><br>
      <code>&nbsp;&nbsp;major="1" minor="1" micro="0"&gt;</code><br>
      <code>&nbsp;&nbsp;<b>...</b></code><br>
      </blockquote>
      <p>There is no restriction on the number of tags in the deployment descriptor. The classifieds.car descriptor contains only one. If a new version of classifieds required modifications to the database, an additional block could accomodate making that change possibly through the combined use of a new database element set and an extension block to perform migration. There are many possibilities.</p><br>
      <i>mrb 9/23/2004</i><br>
      <br>
<!-- end cut this section to put into jasig table cell format --> <br>
<!-- end of main body table cell --> <img height="4" width="692"
 src="../../images/orange-pixel.gif" border="0" alt="."> 	 </td>
    </tr>
  </tbody>
</table>
<!-- page footer -->
<table cellspacing="0" cellpadding="0" width="100%">
  <tbody>
    <tr>
      <td align="center">&nbsp;</td>
    </tr>
    <tr>
      <td align="center"><img height="3" src="../../images/spacer.gif"
 width="1" border="0" alt="."> <br>
      <font face="Verdana, Arial, sans-serif" size="1"><a
 href="http://www.ja-sig.org/">JA-SIG Home</a> <img height="13" alt="*"
 src="../../images/diamond-lo.gif" width="8" border="0"> <a
 href="../../index.html"> About uPortal</a> <img height="13" alt="*"
 src="../../images/diamond-lo.gif" width="8" border="0"> <a
 href="../../faq.html">FAQ</a> <img height="13" alt="*"
 src="../../images/diamond-lo.gif" width="8" border="0"> <a
 href="../download.html">Download</a> <img height="13" alt="*"
 src="../../images/diamond-lo.gif" width="8" border="0"> <a
 href="../../docs.html">Documentation</a> <img height="13" alt="*"
 src="../../images/diamond-lo.gif" width="8" border="0"> <a
 href="../../getinv.html">Getting Involved</a> <img height="13" alt="*"
 src="../../images/diamond-lo.gif" width="8" border="0"> <br>
      <a href="../../cvs.html">Code Repository</a> <img height="13"
 alt="*" src="../../images/diamond-lo.gif" width="8" border="0"> <a
 href="../../bugs.html">Reporting Bugs</a> <img height="13" alt="*"
 src="../../images/diamond-lo.gif" width="8" border="0"> <a
 href="../../license.html">License</a> <img height="13" alt="*"
 src="../../images/diamond-lo.gif" width="8" border="0"> </font></td>
    </tr>
  </tbody>
</table>
<!-- end page footer --> <br>
<br>
<br>
<br>
<br>
<br>
</body>
</html>
