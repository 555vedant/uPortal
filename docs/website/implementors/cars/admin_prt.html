<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
    <!-- TO CHANGE: change the document title -->
  <title>Administration Channel</title>
    <META NAME="AUTHOR" CONTENT="Mark R. Boyd">
  </HEAD>
  <BODY LANG="en-US" TEXT="#000000">
          <br>
<!-- TO CHANGE: main body goes HERE <<<<<<<<<<<<<<<<<< --><!-- start cut this section to put into jasig table cell format -->
      <div align="center"><big><big>Administration Navigation Channel</big></big><br>
      </div>
      <br>
      <big><br>
      <span style="font-weight: bold;"> Contents</span><br>
      </big>
      <blockquote><a href="#what_is_adminNav">What is the Administration Navigation Channel</a><br>
        <a href="#registering_links">Registering Links</a><br>
        <a href="#pluggability">Pluggability of User Interface (Tree anyone?)</a><br>
        <a href="#static_links_file">List Model's static links file: adminNav.xml</a><br>
        <a href="#adding_link">Tutorial: Adding a Static Link</a><br/>
        <a href="#register_via_cars">Registering Links Via CAR Descriptors</a><br/>
      </blockquote>
      <br>
      <br>
      <big><a name="what_is_adminNav"></a><span style="font-weight: bold;">What is the Administration Navigation Channel</span></big><br>
      <p>When an administrator uses the portal, channels meant solely for administrators have shown up traditionally in two different ways. Prior to uPortal 2.6, the 'Channel Admin' link presented the administrator with links to 'Publish a new channel' or 'Modify a currently published channel'. Additionally, depending on how the portal instance is configured there may be an 'Admin Tools' tab pushed into the layout of an administrator. The Admin Nav channel takes the place of rendering the links presented when the 'Channel Admin' link is selected. Previously, this list was provided by the Channel Manager channel. Now it is a standalone, runtime-extensible channel to which links can be added without bloating the channel manager channel with unrelated functionality. Furthermore, unlike the fixed set of channel available on the 'Admin Tools' tab, this channel dynamically alters the list of available links it presents based on the authorizations had by its current user.</p>
      
      <big><a name="registering_links"></a><span style="font-weight: bold;">Registering Links</span></big><br>
      <p>One of the key benefits of the Admin Nav channel is that links can now be added to this area without bloating the channel manager channel with unrelated functionality. Links are added to Admin Nav dynamically at any time after the web server has started up and are not persisted. This means that they must be registered each time that the server starts up. This was done intentionally so that when applications are removed from the portal their administrative links are also removed. To register a link, code must use an implementation of org.jasig.portal.channels.adminnav.ILinkRegistrar. An instance of this interface is acquired by calling a static method on the Admin Nav Channel. The following code snippet shows how links are added. Each step and piece used during registration will be explained.</p>
<blockquote><code>ILinkRegistrar reg = AdminNavChannel.getLinkRegistrar();</code><br>
<code>Map parms = new HashMap();</code><br>
<code>// add parms as needed</code><br>
<code>reg.addLink("&lt;fname Of Channel&gt;", "&lt;lable ID of link&gt;", &lt;ILabelResolver instance&gt;, parms);</code><br>
</blockquote>
      <p>Such registration can take place via a static initializer or a constructor. As will be shown below, such registrations can also be initiated via a declaration in a <a href="../cars/channelArchives.html#deployment_descriptors">CAR deployment descriptor</a> or via a the <a href="#static_links_file">properties/adminNav.xml</a> configuration file depending on Admin Nav's configuration. As can be seen, the addLink method takes four parameters:</p>
      <span style="font-style: italic;">Fname</span>
      <p>The functional name, or fname, of a channel can be defined during publishing. If specified during publishing, the channel can later be instantiated and brought into focus mode in the portal using a special URL if the user has permission to subscribe to that channel. This is true <span style="font-style: italic;">even if that channel does not exist in the user's layout</span>. The fname passed-in when registering a link is used to create one of these special URL as the target for the resulting link that appears in Admin Nav. When one of these links is selected, the channel represented by that functional name will be brought into focus.</p>
      <span style="font-style: italic;">Label ID</span> and <span style="font-style: italic;">ILabelResolver</span>
      <p>The label ID is used to localized the label of the registered link. This ID is passed to the passed-in implementation of ILabelResolver to acquire a localized version of the label for the link whenever Admin Nav regenerates its list. Accordingly, all label ids to be passed to a specific ILabelResolver implementation must be unique within that scope. </p>
      <span style="font-style: italic;">Parameter Map</span>
      <p>The parameter map is meant to be used for name and value pairs suitable for appending to the link's URL as query parameters. Although this is the intended use their interpretation is completely defined by Admin Nav's plugged-in internal implementation to be discussed next. The default internal implementation provided with Admin Nav allows the map to be an optional parameter. For this internal implementation a value of null can safely be passed for the map when registering a link.</p>

      <big><a name="pluggability"></a><span style="font-weight: bold;">Pluggability of User Interface (Tree anyone?)</span></big><br>
      <p>Technically speaking, Admin Nav is not a full fledged channel on its own. It is a wrapper around an implementation that provides its visual representation. Any class that implements <span style="font-style: italic;">org.jasig.portal.channels.adminnav.INavigationModel</span> can be used. A default implementation is provided that presents the links in list form sorted by link label. The implementation to be used is specified using the following <span style="font-style: italic;">portal.properties</span> definition.</p>
<blockquote><code>org.jasig.portal.channels.adminnav.AdminNavigation.implementation</code><br>
<code>&nbsp; = org.jasig.portal.channels.adminnav.provider.ListModel</code><br></blockquote>
      <p>As can be seen, the default implementation is provided by the ListModel class. Since Admin Nav is designed to be pluggable, any user interface could be provided to present these links. For example, a hierarchically organized tree could be used to group related links by administrative area like channel administration versus internal cache administration. Since the implementation defines how the parameter map is used it could also define prefixes to map keys that indicated the parameter was not to be used as a query parameter but defined what portion of the tree the link should be placed under.</p>
      
      <big><a name="static_links_file"></a><span style="font-weight: bold;">List Model's static links file: adminNav.xml</span></big><br>
      <p>In addition to accepting dynamic registrations of links, the reference implementation, ListModel, also looks for links defined statically via a configuration file in the properties directory. The name of the file is <span style="font-style: italic;">adminNav.xml</span>. Upon instantiation, ListModel uses two other utility classes provided with AdminNav to load these statically defined links. And instance of ResourceBundleResolver is instantiated pointed at <span style="font-style: italic;">'/properties/adminNav'</span>. This provides an instance of ILabelResolver that will look for resource bundles with that base name for the current locale of the user.</p>
      <p>For example, the reference implementation provides two property resource bundle files in the properties directory to resolve the labels defined in adminNav.xml. The first is <span style="font-style: italic;">'adminNav.properties'</span> which defines the base bundle which will be used if no locale or language specific version is located. The second is <span style="font-style: italic;">'adminNav_de_DE.properties'</span> to showcase labels rendering in German if the German locale is selected. However, this is only meant as sample file and at the time of this writing did not contain actual German versions of the labels.</p>
      <p>The ResourceBundleProvider instance is then passed to an instance of XMLLinksFileLoader along with the path to adminNav.xml. XMLLinksFileLoader loads an XML file using an instance of XMLLinksHandler which defines the structure found in adminNav.xml and is responsible for making the calls to register the links found there-in. Copious comments are include in adminNav.xml explaining the XML structure that should be used when defining static links. <span style="font-weight: bold;">Remember:</span> for each link registered the appropriate entries should be added to the resource bundles that will provide the locale specific versions of the labels for those links. </p>

      <big><a name="adding_link"></a><span style="font-weight: bold;">Tutorial: Adding a Static Link</span></big><br>
      <p>As an example, lets add the Number Guessing Game to the list of links that appear in Admin Nav. Using the Channel Manager channel we look at the publishing information for Number Guessing Game. It has a functional name of <span style="font-style: italic;">'number-guessing-game'</span>. Furthermore, since the labels for ListModel come from adminNav.properties and its derivative property resource bundles we'll use a lable id that does not conflict with any other keys in those property files, say <span style="font-style: italic;">'NUMBER_GUESSING_GAME'</span>. Following the comments in properties/adminNav.xml we add the following declaration:</p>

<blockquote><code>&lt;link labelId="NUMBER_GUESSING_GAME" channelFunctionalName="number-guessing-game"/&gt;</code><br></blockquote>

       <p>To the base property file adminNav.properties we'll add the following label declaration.</p>
<blockquote><code>NUMBER_GUESSING_GAME=Number Guessing Game</code><br></blockquote>
       <p>To the German version of this property resource bundle, adminNav_de_DE.properties, we'll add the following label declaration.</p>
<blockquote><code>NUMBER_GUESSING_GAME=Nummer-Erraten-Spiel</code><br></blockquote>
       <p>After saving all three files, re-deploying, and restarting the web server the Number Guessing Game link now appears and presents and appropriate lable for both the English and German locales.</p>

      <big><a name="register_via_cars"></a><span style="font-weight: bold;">Registering Links Via CAR Descriptors</span></big><br>
      <p>Looking back at XMLLinksHandler we see that it is an implementation of ContentHandler, it can be used in an extension block in a CAR deployment descriptor. When used in this manner a resource bundle resolver instance must be provided using an optional attribute of the outermost &lt;links&gt; element. The 'bundleResolver' attribute should hold the class resource path for a base resource bundle name that should be used to resolve registered link labels. This includes bundles located in CARs.</p>
      <p>As an example, lets register the Number Guessing Game in the same manner as we did above but via a CAR deployment descriptor. Using the same lable id and functional name as before and knowing that there are resource bundles with a base bundle name of properties/adminNav we can construct a CAR with the following deployment descriptor. Each time the server starts up this descriptor will be processed and the link added again.</p>
      
<blockquote><code>&lt;ext contentHandler="org.jasig.portal.channels.adminnav.XMLLinksHandler"&gt;</code><br>
<code>&nbsp; &lt;links bundleResolver="properties/adminNav"&gt;</code><br>
<code>&nbsp; &nbsp; &lt;link labelId="NUMBER_GUESSING_GAME" channelFunctionalName="number-guessing-game"/&gt;</code><br>
<code>&nbsp; &lt;/links&gt;</code><br>
<code>&lt;/ext&gt;</code><br></blockquote>

      <i>mrb 8/22/2005</i><br>
      <br>
<!-- end cut this section to put into jasig table cell format --> <br>
          <br>
             <!-- end of main body table cell -->
  </BODY>
</HTML>