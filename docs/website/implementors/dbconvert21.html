<!DOCTYPE HTML PUBLIC "-//SoftQuad Software//DTD HoTMetaL PRO 6.0::19990601::extensions to HTML 4.0//EN" "hmpro6.dtd">
<html>
<head>
  <title>Dbconvert21 Tool</title>
  <link href="../uportal.css" rel="stylesheet">
</head>
<body style="background-color: rgb(255, 255, 255);">
<table cellspacing="0" cellpadding="0" width="100%">
  <tbody>
    <tr>
      <td align="left" valign="bottom" colspan="3"><img
 src="../images/uportal-head.gif" alt="uPortal by JA-SIG" border="0"
 height="87" width="592"></td>
    </tr>
    <tr>
      <td><img src="../images/spacer.gif" alt="." border="0" height="4"
 width="1"></td>
    </tr>
  </tbody>
</table>
<table cellspacing="0" cellpadding="5" width="100%" border="0">
  <tbody>
    <tr>
      <td valign="top" width="150" bgcolor="#ccccff"> <img
 src="../images/spacer.gif" border="0" height="4"><br>
      <p><a class="sidelinks" href="http://www.ja-sig.org/"><b> JA-SIG
Home</b></a></p>
      <p><a class="sidelinks" href="../index.html"><b> About uPortal</b></a></p>
      <p><a class="sidelinks" href="../docs.html"><b> Documentation</b></a></p>
      <p><a class="sidelinks" href="../administrators/index.html"><b>Getting
Started</b></a></p>
      <p><a class="sidelinks" href="../developers/index.html"><b>Developers</b></a></p>
      <p><a class="sidelinks" href="index.html"><b> Implementors</b></a></p>
      <p><a class="sidelinks" href="../users/index.html"><b> Users</b></a></p>
      <p><a class="sidelinks" href="../architecture/index.html"><b>Background</b></a></p>
      <p><a class="sidelinks" href="../release/index.html"><b> Release</b></a></p>
      <p><img src="../images/mellon.gif" alt="" border="0" width="145"
 height="93"></p>
      </td>
<!-- main body goes in this table cell --> <td valign="top"> <img
 height="4" width="692" src="../images/orange-pixel.gif" border="0"
 alt=".">
      <h2>DbConvert21<br>
      </h2>
      <p>The DbConvert21 tool is used to upgrade a uPortal 2.1.x
database so that it can be used with uPortal 2.3.x code.&nbsp; The
following instructions describe the steps need to complete the
conversion.&nbsp; <br>
      </p>
      <p>Note that this converstion assumes that you will be running
uPortal 2.3 with your original uPortal 2.1.x stucture and theme
stylesheets, you will not be using aggregated layouts, and you will
have internationalization features disabled.&nbsp; The ability to
enable aggregated layouts and internationalization as a result of this
upgrade is currently being worked on.<br>
      </p>
      <h3>Changes to database schema<br>
      </h3>
      <ul>
        <li>Add a new column to <code>UP_CHANNEL: CHAN_SECURE</code>.</li>
        <li>Add a new column to <code>UP_ENTITY_CACHE_INVALIDATION:
ENTITY_CACHE_ID</code><br>
        </li>
      </ul>
      <h3>Changes to database data<br>
      </h3>
      <ul>
        <li>Add a root folder element to all users' layouts by running
the<span style="font-family: monospace;"> </span>conversion tool
included with uPortal 2.3.x: ant dbconvert21.<br>
        </li>
      </ul>
      <ul>
        <li>Add a row to <code>UP_CHAN_TYPE</code> for the Portlet
Adapter:<br>
          <br>
          <code>INSERT INTO UP_CHANE_TYPE VALUES (7,
'org.jasig.portal.channels.portlet.CPortletAdapter', 'Portlet',
'Adapter for JSR-168 Portlets',
'/org/jasig/portal/channels/portlet/CPortletAdapter.cpd')</code><br>
        </li>
      </ul>
      <pre wrap="">  You may have to change your TYPE_ID from 7 to another value if you have added rows to this table.<br></pre>
      <ul>
        <li>Change the URL's to your theme and structure stylesheets so
that they can be loaded from the<span style="font-family: monospace;"> </span>classpath.
Essentially, this means that you need to strip off 'stylesheets' from
the beginning<span style="font-family: monospace;"> </span>of each URL
in <code>UP_SS_STRUCT.SS_URI</code>, and <code>UP_SS_STRUCT.SS_DESCRIPTION_URI</code>,&nbsp;
          <span style="font-family: monospace;"></span><code>UP_SS_THEME.SS_URI</code>,
and <code>UP_SS_THEME.SS_DESCRIPTION_URI</code>.<span
 style="font-family: monospace;"></span><br>
          <br>
For example, change<br>
          <br>
          <code>stylesheets/org/jasig/portal/layout/tab-column/nested-tables/nested-tables.xsl</code><br>
to<br>
          <code>/org/jasig/portal/layout/tab-column/nested-tables/nested-tables.xsl<br>
          </code>
          <br>
       </li>

       <li>To turn on functionality of &quot;Site Map&quot; in the header,
       three tables need to be changed, as follows:<br>
       <br>
       1) Retrieve the 'sequence_value' from the <code>UP_SEQUENCE table where sequence_name='UP_CHANNEL'</code>:<br>
       <br>
       <code>SELECT sequence_value FROM UP_SEQUENCE WHERE sequence_name='UP_CHANNEL';</code><br>
       <br>
       2) Use this retrieved value (denoted as 'x' in the statement below)
       to do an insert into the <code>UP_CHANNEL</code> table:<br>
       <br>
       <code>INSERT INTO UP_CHANNEL VALUES (x, 'Site Map','Site Map','A quick view of all your tabs and channels', 'org.jasig.portal.layout.channels.sitemap.CSiteMap', -1, 0, sysdate, 0, sysdate, 30000, 'N', 'N', 'N', 'layout-sitemap', 'N');</code><br>
       <br>
       3) Insert a row into the <code>UP_PERMISSION</code> table to allow all users 
       access to the Site Map channel (where 'x' in the statement below is 
       the same chan_id used in the insert statement in #2):<br>
       <br>
       <code>INSERT INTO UP_PERMISSION VALUES
       ('UP_FRAMEWORK', 3, 'local.0', 'SUBSCRIBE', 'CHAN_ID.x', 'GRANT', null, null);</code><br>
       <br>
       4) Update the sequence_value for UP_CHANNEL in the UP_SEQUENCE table 
       for the next incremental value:<br>
       <br>
       <code>UPDATE UP_SEQUENCE SET sequence_value = sequence_value+1
       WHERE sequence_name='UP_CHANNEL';</code><br>
       <br>
      </ul>

      <h3>Changes to portal.properties</h3>
      <ul>
        <li>Disable aggregated layouts by setting the following
properties:<br>
          <br>
          <code>org.jasig.portal.layout.UserLayoutManagerFactory.coreImplementation=org.jasig.portal.layout.SimpleUserLayoutManager<br>
org.jasig.portal.UserLayoutStoreFactory.implementation=org.jasig.portal.RDBMUserLayoutStore</code><br>
        </li>
      </ul>
      <ul>
        <li>Disable internationalization by setting the following
property:<br>
          <br>
          <code>org.jasig.portal.i18n.LocaleManager.locale_aware=false</code></li>
      </ul>
      <code></code><img height="4" width="692"
 src="../images/orange-pixel.gif" border="0" alt="."> </td>
    </tr>
  </tbody>
</table>
<!-- page footer -->
<table cellspacing="0" cellpadding="0" width="100%">
  <tbody>
    <tr>
      <td align="center">&nbsp;</td>
    </tr>
    <tr>
      <td align="center"><img height="3" src="../images/spacer.gif"
 width="1" border="0" alt="."><br>
      <font face="Verdana, Arial, sans-serif" size="1"><a
 href="http://www.ja-sig.org/">JA-SIG Home</a> <img height="13" alt="*"
 src="../images/diamond-lo.gif" width="8" border="0"> <a
 href="../index.html"> About uPortal</a> <img height="13" alt="*"
 src="../images/diamond-lo.gif" width="8" border="0"> <a
 href="../faq.html">FAQ</a> <img height="13" alt="*"
 src="../images/diamond-lo.gif" width="8" border="0"> <a
 href="../download.html">Download</a> <img height="13" alt="*"
 src="../images/diamond-lo.gif" width="8" border="0"> <a
 href="../docs.html">Documentation</a> <img height="13" alt="*"
 src="../images/diamond-lo.gif" width="8" border="0"> <a
 href="../getinv.html">Getting Involved</a> <img height="13" alt="*"
 src="../images/diamond-lo.gif" width="8" border="0"> <br>
      <a href="../cvs.html">Code Repository</a> <img height="13"
 alt="*" src="../images/diamond-lo.gif" width="8" border="0"> <a
 href="../bugs.html">Reporting Bugs</a> <img height="13" alt="*"
 src="../images/diamond-lo.gif" width="8" border="0"> <a
 href="../license.html">License</a> <img height="13" alt="*"
 src="../images/diamond-lo.gif" width="8" border="0"> </font></td>
    </tr>
  </tbody>
</table>
<!-- end page footer -->
</body>
</html>
